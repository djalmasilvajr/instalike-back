"use strict";function onYouTubeIframeAPIReady(){Array.from(document.querySelectorAll(".yt-player")).map(function(e){return e.id}).forEach(function(e){return createYoutubePlayer(e)})}function createYoutubePlayer(t){return markProgressFor(t),new YT.Player(t,{playerVars:{playsinline:1},events:{onStateChange:function(e){return onYoutubePlayerStateChange(e,t)}}})}var PERCENTAGE_TO_SHOW_SUGGEST_TASK_TOOLTIP=95;function fireEventOnNearClassCompletion(e){var t=progressPercentage(e);PERCENTAGE_TO_SHOW_SUGGEST_TASK_TOOLTIP<=t?document.dispatchEvent(new Event("ImmersionClassNearCompletionEvent")):setTimeout(function(){fireEventOnNearClassCompletion(e)},5e3)}var fireEventOnNearClassCompletionOnce=once(function(e){fireEventOnNearClassCompletion(e)});function onYoutubePlayerStateChange(e,t){e.data===YT.PlayerState.PLAYING&&(sendDataToGA("started_immersion",t),fireEventOnNearClassCompletionOnce(t)),e.data===YT.PlayerState.PAUSED&&progressPercentage(t)<80&&sendDataToGA("stopped_watching_the_immersion",t),(e.data===YT.PlayerState.ENDED||80<=progressPercentage(t))&&sendDataToGA("completed_immersion",t)}function markProgressFor(e){var e=$("#"+e),e=new URL(e[0].src),t=document.querySelector(".class-page__video"),a=t.dataset.immersionClassId;"true"!==t.dataset.userHasAlreadySeenTheClass&&$.post("/immersionclassprogress/"+a,{url:e.toString()})}function progressPercentage(e){var t=window.YT,a=t.get(e).getDuration();return t.get(e).getCurrentTime()/a*100}function sendDataToGA(e,t){var a=window.dataLayerAlura||[],r=document.querySelector(".class-page__video"),t=window.YT.get(t).getCurrentTime()/60;a.push({event:e,name:r.dataset.immersionClassTitle,immersion:{category:r.dataset.immersionCategoryName,name:r.dataset.immersionName},workload:r.dataset.immersionWorkload,assisted_time:t})}function once(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}